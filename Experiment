import fitz  # PyMuPDF
import os

def extract_and_save_images(pdf_path, output_folder):
    # Create output folder if it doesn't exist
    os.makedirs(output_folder, exist_ok=True)

    pdf_document = fitz.open(pdf_path)

    for page_num in range(len(pdf_document)):
        page = pdf_document[page_num]
        images = page.get_images(full=True)

        for img_index, img_info in enumerate(images):
            img_index += 1  # Adjust index since it starts from 1

            image_index_str = f"Image_{img_index}_Page_{page_num + 1}"
            img_data = pdf_document.extract_image(img_info)
            
            # Fix the image index
            if isinstance(img_info[0], int):
                img_index = img_info[0]
            else:
                img_index = img_index + 1

            img = Image.open(BytesIO(img_data['image']))
            img.save(os.path.join(output_folder, f"{image_index_str}.png"), "PNG")

    pdf_document.close()

# Example usage
pdf_path = 'path/to/your/file.pdf'
output_folder = 'path/to/your/output/folder'
extract_and_save_images(pdf_path, output_folder)

img_index = img_info[0] if isinstance(img_info[0], int) else img_index + 1
