import pandas as pd
import numpy as np

# Load the dataset
file_path = '/mnt/data/your_excel_file.xlsx'  # Replace with the actual file path
df = pd.read_excel(file_path)

# Ensure the column names are correct as per the provided screenshot
df.columns = ['Unique Eventid', 'Legal Entity', 'Trade ID', 'ROC', 'Age', 'Age Band', 'Counterparty Name', 'Business Event', 'Product Representation', 'Days Spent', 'Action Items']

# Sort the data by Unique Eventid and a time-related column (e.g., Age) to ensure transitions are in order
df = df.sort_values(by=['Unique Eventid', 'Age'])

# Calculate transitions between Action Items
transition_counts = pd.crosstab(df['Action Items'], df['Action Items'].shift(-1), dropna=False)

# Exclude transitions to NaN values as they don't represent actual state transitions
transition_counts = transition_counts.iloc[:-1, :-1]

# Normalize the matrix to get transition probabilities
transition_matrix = transition_counts.div(transition_counts.sum(axis=1), axis=0)

# Display the transition matrix
print(transition_matrix)

# Save the transition matrix to an Excel file
transition_matrix.to_excel('/mnt/data/transition_probability_matrix.xlsx')

print("Transition probability matrix saved to transition_probability_matrix.xlsx")
