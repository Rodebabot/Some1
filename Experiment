import pandas as pd

# Load the Excel file
file_path = '/mnt/data/your_excel_file.xlsx'  # Replace with the actual file path
df = pd.read_excel(file_path)

# Group by Unique EventID, ROC, and Age Band
grouped = df.groupby(['Unique Eventid', 'ROC', 'Age Band']).agg({'Days Spent': 'sum'}).reset_index()

# Calculate the total days spent for each Unique EventID
total_days = df.groupby('Unique Eventid')['Days Spent'].sum().reset_index()
total_days.rename(columns={'Days Spent': 'Total Days Spent'}, inplace=True)

# Merge the grouped data with the total days
merged = pd.merge(grouped, total_days, on='Unique Eventid')

# Calculate the percentage of days spent for each combination
merged['Percentage of Days'] = (merged['Days Spent'] / merged['Total Days Spent']) * 100

# Create the summary table
summary = merged.groupby(['ROC', 'Age Band']).agg({
    'Percentage of Days': 'mean',
    'Days Spent': 'sum',
    'Unique Eventid': 'nunique'
}).reset_index()

# Sort the summary table by the percentage of days in descending order
summary = summary.sort_values(by='Percentage of Days', ascending=False)

# Save the summary to a new Excel file
summary.to_excel('/mnt/data/summary_analysis.xlsx', index=False)

print("Analysis completed. Summary saved to summary_analysis.xlsx")
