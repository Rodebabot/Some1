import tkinter as tk
from tkinter import ttk, messagebox
import pandas as pd

class TaskScorerApp:
    def __init__(self, master):
        self.master = master
        self.master.title("Task Scorer App")

        self.task_name_label = ttk.Label(master, text="Task Name:")
        self.task_name_label.grid(row=0, column=0, padx=5, pady=5, sticky=tk.W)

        self.task_name_entry = ttk.Entry(master)
        self.task_name_entry.grid(row=0, column=1, padx=5, pady=5, sticky=tk.W)

        # Read variables and categories from the input Excel file and remove duplicates
        input_data = pd.read_excel('your_input_file.xlsx')
        input_data = input_data.drop_duplicates(subset=['Variable', 'Category'])

        self.variables = list(input_data['Variable'])
        self.categories = list(input_data['Category'])

        self.var_entries = []
        for i, var in enumerate(self.variables):
            ttk.Label(master, text=var).grid(row=i + 1, column=0, padx=5, pady=5, sticky=tk.W)
            var_entry = ttk.Combobox(master, values=self.categories)
            var_entry.grid(row=i + 1, column=1, padx=5, pady=5, sticky=tk.W)
            self.var_entries.append(var_entry)

        self.submit_button = ttk.Button(master, text="Submit", command=self.calculate_score)
        self.submit_button.grid(row=len(self.variables) + 2, column=0, columnspan=2, pady=10)

    def calculate_score(self):
        task_name = self.task_name_entry.get()

        if not task_name:
            messagebox.showerror("Error", "Please enter a task name.")
            return

        # Create a DataFrame to store the scores
        scores_df = pd.DataFrame(columns=['Task Name', 'Variable', 'Category', 'Score'])

        for var, entry in zip(self.variables, self.var_entries):
            category = entry.get()

            # Read the score from the Excel file (replace 'your_excel_file.xlsx' with your actual file)
            excel_data = pd.read_excel('your_excel_file.xlsx')
            score = excel_data[(excel_data['Variable'] == var) & (excel_data['Category'] == category)]['Score'].values[0]

            # Append the score to the DataFrame
            scores_df = pd.concat([scores_df, pd.DataFrame({'Task Name': [task_name], 'Variable': [var], 'Category': [category], 'Score': [score]})], ignore_index=True)

        # Calculate the total score
        total_score = scores_df['Score'].sum()

        # Display or save the result as needed (replace 'output_file.xlsx' with your desired output file)
        messagebox.showinfo("Result", f"Task: {task_name}\nTotal Score: {total_score}")
        scores_df.to_excel('output_file.xlsx', index=False)

if __name__ == "__main__":
    root = tk.Tk()
    app = TaskScorerApp(root)
    root.mainloop()
