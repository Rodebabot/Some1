import pandas as pd
from collections import Counter
import string
from nltk.corpus import stopwords

# Load data with financial sentences
df = pd.DataFrame({
    'Group': ['A', 'A', 'B', 'B', 'C', 'C', 'D', 'D', 'E', 'E'],
    'Row Labels': [
        'The stock market closed higher today', 
        'Investors are optimistic about the earnings report', 
        'The company announced a dividend increase', 
        'Quarterly revenue exceeded expectations', 
        'The central bank raised interest rates', 
        'Inflation concerns are impacting the market', 
        'The merger is expected to boost growth', 
        'Share prices surged after the acquisition news', 
        'Analysts are predicting a strong quarter', 
        'The financial sector is showing resilience'
    ]
})

# Preprocess text: Remove punctuation, convert to lowercase, and remove stop words
nltk.download('stopwords')
stop_words = set(stopwords.words('english'))

def preprocess_text(text):
    translator = str.maketrans('', '', string.punctuation)
    text = text.translate(translator).lower()
    words = text.split()
    filtered_words = [word for word in words if word not in stop_words]
    return ' '.join(filtered_words)

df['Processed Text'] = df['Row Labels'].apply(preprocess_text)

# Function to count word frequencies in a list of texts
def count_words(texts):
    word_count = Counter()
    for text in texts:
        words = text.split()
        word_count.update(words)
    return word_count

# Group by 'Group' and count word frequencies for each group
grouped = df.groupby('Group')['Processed Text'].apply(list)

results = {}
for group, texts in grouped.items():
    word_count = count_words(texts)
    results[group] = word_count.most_common()

# Display results
for group, word_freq in results.items():
    print(f"Group {group}:")
    for word, freq in word_freq:
        print(f"  {word}: {freq}")

# Aggregate word counts across all groups
all_texts = df['Processed Text'].tolist()
overall_word_count = count_words(all_texts)

# Find the overall most frequent word
most_common_word, most_common_count = overall_word_count.most_common(1)[0]

# Display the overall most frequent word
print(f"\nOverall most frequent word: '{most_common_word}' with a count of {most_common_count}")
