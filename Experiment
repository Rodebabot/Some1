import win32com.client
import pandas as pd

# Initialize Outlook application
outlook = win32com.client.Dispatch("Outlook.Application")
namespace = outlook.GetNamespace("MAPI")

# Access the mailbox (replace 'SADDA' with the exact name of your mailbox)
mailbox = namespace.Folders['SADDA']

# Function to search through folders and subfolders
def search_folder(folder):
    emails = []
    for item in folder.Items:
        if item.Class == 43:  # Mail item
            if "OTCWORK" in item.Body:
                emails.append({
                    'Subject': item.Subject,
                    'ReceivedTime': item.ReceivedTime
                })
    for subfolder in folder.Folders:
        emails += search_folder(subfolder)
    return emails

# Start searching from the inbox or the root of the mailbox
inbox = mailbox.Folders['Inbox']
emails = search_folder(inbox)

# Create a DataFrame and save to Excel
df = pd.DataFrame(emails)
df.to_excel('OTCWORK_emails.xlsx', index=False)

print("Excel file created successfully.")
