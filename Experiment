import os
from pyxlsb import open_workbook
import pandas as pd
import datetime

# Get today's date in the format "ddmm"
current_day_month = datetime.datetime.now().strftime("%d%m")

# Specify the parent directory to search
parent_directory_path = "/path/to/parent/directory"

# List files in the parent directory
files = [f for f in os.listdir(parent_directory_path) if os.path.isfile(os.path.join(parent_directory_path, f))]

# Filter XLSB files with today's date in the filename
xlsb_files_today = [f for f in files if f.endswith('.xlsb') and current_day_month in f]

# If there's an XLSB file with today's date in the filename, read it
if xlsb_files_today:
    xlsb_file_path = os.path.join(parent_directory_path, xlsb_files_today[0])
    print("Found XLSB file for today:", xlsb_file_path)

    # Initialize a list to store DataFrames for each sheet
    dfs = []

    # Open the XLSB file
    with open_workbook(xlsb_file_path) as wb:
        # Iterate over sheets in the workbook
        for sheetname in wb.sheets:
            # Read each sheet into a DataFrame
            with wb.get_sheet(sheetname) as sheet:
                data = []
                for row in sheet.rows():
                    data.append([item.v for item in row])
                df = pd.DataFrame(data[1:], columns=data[0])  # Assuming the first row is headers
                dfs.append(df)

    # Example usage of the DataFrames
    for i, df in enumerate(dfs, start=1):
        print(f"DataFrame {i}:")
        print(df.head())  # Print the first few rows of each DataFrame
else:
    print("No XLSB file found for today.")
