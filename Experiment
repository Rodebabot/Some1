import dash
from dash import dcc, html
from dash.dependencies import Input, Output
import pandas as pd
import openpyxl

# Load the Excel file into a DataFrame
df = pd.read_excel('company_data.xlsx')

# Initialize the Dash app
app = dash.Dash(__name__)

# Define the app layout
app.layout = html.Div([
    dcc.Dropdown(
        id='company-dropdown',
        options=[{'label': company, 'value': company} for company in df['Company']],
        placeholder="Select a company"
    ),
    html.Div(id='variable-values'),
    dcc.RadioItems(
        id='final-update',
        options=[
            {'label': 'Downfall', 'value': 'Downfall'},
            {'label': 'Rise', 'value': 'Rise'}
        ],
        labelStyle={'display': 'block'},
        style={'margin-top': '20px'}
    )
])

# Define callback functions
@app.callback(
    Output('variable-values', 'children'),
    Input('company-dropdown', 'value')
)
def display_variables(selected_company):
    if not selected_company:
        raise PreventUpdate

    # Filter data for the selected company
    selected_data = df[df['Company'] == selected_company]

    # Create a table to display variables and values
    table = html.Table(
        # Header
        [html.Tr([html.Th(col) for col in selected_data.columns[1:-2]])] +
        # Data
        [html.Tr([html.Td(selected_data.iloc[0][col]) for col in selected_data.columns[1:-2]])]
    )

    return table

@app.callback(
    Output('final-update', 'value'),
    Input('final-update', 'value')
)
def update_final_update(value):
    if value is not None and app.callback_context.triggered[0]['prop_id'] == 'final-update.value':
        # Update the 'Final Update' column in the DataFrame
        selected_company = app.callback_context.inputs_list[0]['value']
        df.loc[df['Company'] == selected_company, 'Final Update'] = value

        # Save the updated DataFrame back to the Excel file
        df.to_excel('company_data.xlsx', index=False, engine='openpyxl')

    return value

if __name__ == '__main__':
    app.run_server(debug=True)
