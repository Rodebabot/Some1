import pandas as pd
import numpy as np

# Assuming 'action' is your DataFrame

# Group by Counterparty Name and ROC, then calculate the median of Days Spent
median_days = action.groupby(['Counterparty Name', 'ROC'])['Days Spent'].median().reset_index()

# Pivot the table to have ROCs as columns
pivot_table = median_days.pivot(index='Counterparty Name', columns='ROC', values='Days Spent').reset_index()

# Highlight the top 3 median values for each Counterparty Name
def highlight_top3(s):
    is_top3 = s.nlargest(3).isin(s)
    return ['background-color: yellow' if v else '' for v in is_top3]

highlighted_table = pivot_table.style.apply(highlight_top3, axis=1)

# Save to CSV
pivot_table.to_csv('/mnt/data/median_days_per_counterparty.csv', index=False)

highlighted_table.to_excel('/mnt/data/median_days_per_counterparty_highlighted.xlsx', index=False)

highlighted_table
