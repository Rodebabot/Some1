import pandas as pd

# Assuming you have already read your CSV into a DataFrame named top_clusters
# top_clusters = pd.read_csv('path_to_csv_file.csv')

# List of action items to include
action_items = [
    "Unactioned", 
    "Counterparty", 
    "Powai Ops - Inbound - Suppression", 
    "Cancelled", 
    "Powai Ops - Inbound - Review", 
    "Transaction Legal Owned", 
    "MO/FO", 
    "Template Negotiation"
]

# Function to filter the top quarter for given action item excluding "0-5 Days"
def filter_top_quarter(df, action_item):
    filtered_df = df[(df['Action Items'] == action_item) & (df['Age Band'] != '0-5 Days')]
    num_rows = len(filtered_df)
    top_quarter = int(num_rows * 0.25)
    return filtered_df.sort_values(by='Cluster Count', ascending=False).head(top_quarter)

# Dictionary to hold the DataFrames for each action item
dfs = {}

# Apply the filter function for each action item and store the DataFrame in the dictionary
for action_item in action_items:
    df_name = f"df_{action_item.replace(' ', '_').replace('-', '_').replace('/', '_').lower()}"
    dfs[df_name] = filter_top_quarter(top_clusters, action_item)

# Now dfs dictionary contains DataFrames for each action item
# You can access them like dfs['df_unactioned'], dfs['df_counterparty'], etc.
for df_name, df in dfs.items():
    print(f"DataFrame for {df_name}:")
    print(df)
    print("\n")

# Optionally, save each DataFrame to a new CSV
# for df_name, df in dfs.items():
#     df.to_csv(f'{df_name}.csv', index=False)
