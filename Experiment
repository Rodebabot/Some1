import pandas as pd
from pyOutlook import Outlook
from bs4 import BeautifulSoup

# Connect to Outlook
outlook = Outlook()

# Specify the mailbox and subfolder
mailbox_name = "your_mailbox_name@example.com"
subfolder_name = "Your Subfolder Name"

# Get all emails from the subfolder
emails = outlook.get_emails(mailbox_name, subfolder_name)

# Initialize an empty list to store table data
table_data = []

# Iterate through emails and extract tables from email bodies with subject containing "inline" (case-insensitive)
for email in emails:
    if "inline" in email.subject.lower():
        soup = BeautifulSoup(email.body, 'html.parser')
        tables = soup.find_all('table')
        for table in tables:
            # Extract table data and store it
            table_data.append(pd.read_html(str(table))[0])

# Concatenate the tables into a single DataFrame
if table_data:
    df_tables = pd.concat(table_data, ignore_index=True)

    # Save the DataFrame to an Excel file
    excel_file_name = "tables_with_inline_subject.xlsx"
    df_tables.to_excel(excel_file_name, index=False)

    print(f"Extracted tables from emails with 'inline' (case-insensitive) subject to {excel_file_name}")
else:
    print("No tables found in emails with 'inline' (case-insensitive) subject")

# Close the Outlook connection
outlook.close()
