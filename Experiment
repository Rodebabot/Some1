import os
import chardet
import pandas as pd

# Function to detect encoding of a file
def detect_encoding(file_path):
    with open(file_path, 'rb') as f:
        rawdata = f.read()
    result = chardet.detect(rawdata)
    return result['encoding']

# Specify the directory to search
directory_path = "/path/to/directory"

# List files in the directory
files = [f for f in os.listdir(directory_path) if os.path.isfile(os.path.join(directory_path, f))]

# Filter files containing 'today' in the filename
files_today = [f for f in files if 'today' in f.lower()]

# Read the first matching file with encoding error handling
if files_today:
    file_path = os.path.join(directory_path, files_today[0])
    encoding = detect_encoding(file_path)
    try:
        with open(file_path, 'r', encoding=encoding) as file:
            # Read lines from the file
            lines = file.readlines()
        
        # Create a DataFrame from the lines
        df = pd.DataFrame([line.split() for line in lines], columns=['Column1', 'Column2', 'Column3', 'Column4', 'Column5'])
        
        # Save DataFrame to CSV
        output_csv_path = '/path/to/output.csv'
        df.to_csv(output_csv_path, index=False)
        
        print("File converted and saved successfully as:", output_csv_path)
    except Exception as e:
        print("Error converting the file:", e)
else:
    print("No file containing 'today' in the filename found in the directory.")
