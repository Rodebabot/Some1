import os
import pandas as pd

folder_path = 'path/to/your/excel/files'

# Create a new folder to store modified Excel files
output_folder = 'path/to/your/output/folder'
os.makedirs(output_folder, exist_ok=True)

def add_substring_column(file_path, output_folder):
    # Read the Excel file, skipping the first three rows
    df = pd.read_excel(file_path, engine='openpyxl', skiprows=3)

    # Extract a substring from the file name where it starts with '2' and ends just before the next '.'
    file_name = os.path.basename(file_path)
    start_index = file_name.find('2')
    end_index = file_name.find('.', start_index)
    if start_index != -1 and end_index != -1:
        substring = file_name[start_index:end_index]

        # Add a new column with the extracted substring
        df['Extracted_Substring'] = substring

    # Construct the output file path with a new extension
    output_file = os.path.join(output_folder, os.path.basename(file_path))

    # Write the modified dataframe to the new Excel file
    df.to_excel(output_file, index=False)

# Iterate through all Excel files in the specified folder
for file_name in os.listdir(folder_path):
    if file_name.endswith('.xlsx') or file_name.endswith('.xls'):
        file_path = os.path.join(folder_path, file_name)
        add_substring_column(file_path, output_folder)





import os
import pandas as pd

folder_path = 'path/to/your/excel/files'

# Create a new folder to store modified Excel files
output_folder = 'path/to/your/output/folder'
os.makedirs(output_folder, exist_ok=True)

def add_substring_column(file_path, output_folder):
    # Read the Excel file, skipping the first three rows
    df = pd.read_excel(file_path, engine='openpyxl', skiprows=3)

    # Extract a substring from the file name starting after the 2nd appearance of '-' until '.xlsx'
    file_name = os.path.basename(file_path)
    start_index = file_name.find('-', file_name.find('-') + 1)
    end_index = file_name.find('.xlsx')
    if start_index != -1 and end_index != -1:
        substring = file_name[start_index + 1:end_index]

        # Add a new column with the extracted substring
        df['Extracted_Substring'] = substring

    # Construct the output file path with a new extension
    output_file = os.path.join(output_folder, os.path.basename(file_path))

    # Write the modified dataframe to the new Excel file
    df.to_excel(output_file, index=False)

# Iterate through all Excel files in the specified folder
for file_name in os.listdir(folder_path):
    if file_name.endswith('.xlsx') or file_name.endswith('.xls'):
        file_path = os.path.join(folder_path, file_name)
        add_substring_column(file_path, output_folder)








import os
import pandas as pd

folder_path = 'path/to/your/excel/files'

# Create a new folder to store modified Excel files
output_folder = 'path/to/your/output/folder'
os.makedirs(output_folder, exist_ok=True)

def add_substring_column(file_path, output_folder):
    # Read the Excel file, skipping the first three rows
    df = pd.read_excel(file_path, engine='openpyxl', skiprows=3)

    # Extract a substring from the file name as the previous 5 characters before '.xlsx'
    file_name = os.path.basename(file_path)
    if file_name.endswith('.xlsx'):
        substring = file_name[-10:-5]  # Extract the previous 5 characters before '.xlsx'

        # Add a new column with the extracted substring
        df['Extracted_Substring'] = substring

        # Construct the output file path with a new extension
        output_file = os.path.join(output_folder, os.path.basename(file_path))

        # Write the modified dataframe to the new Excel file
        df.to_excel(output_file, index=False)

# Iterate through all Excel files in the specified folder
for file_name in os.listdir(folder_path):
    if file_name.endswith('.xlsx') or file_name.endswith('.xls'):
        file_path = os.path.join(folder_path, file_name)
        add_substring_column(file_path, output_folder)
