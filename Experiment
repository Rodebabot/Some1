import pandas as pd
from shareplum import Site
from shareplum.site import Version

# SharePoint site credentials and URL
username = "your_username"
password = "your_password"
site_url = "https://your-sharepoint-site.com/sites/your-site"

# Excel file path
excel_file_path = "path/to/your/excel/file.xlsx"

# SharePoint library name
library_name = "Documents"

# Connect to SharePoint site
site = Site(site_url, version=Version.v365, auth=(username, password))

# Get the library
library = site.List(library_name)

# Read Excel data into a DataFrame
excel_data = pd.read_excel(excel_file_path)

# Convert DataFrame to a list of dictionaries (each row becomes a dictionary)
data_to_upload = excel_data.to_dict(orient="records")

# Upload data to SharePoint
for item in data_to_upload:
    try:
        library.add_item(item)
    except Exception as e:
        print(f"Error uploading item: {item}. Error: {e}")

print("Data uploaded successfully to SharePoint.")
