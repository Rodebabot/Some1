import os
import pandas as pd
import datetime

# Get current month and year
current_month_year = datetime.datetime.now().strftime("%b %Y")
current_day_month = datetime.datetime.now().strftime("%d %b")

# Specify the parent directory to search
parent_directory_path = "/path/to/parent/directory"

# List directories in the parent directory
directories = [d for d in os.listdir(parent_directory_path) if os.path.isdir(os.path.join(parent_directory_path, d))]

# Filter directories based on current month and year
matching_directories = [d for d in directories if current_month_year in d]

# If there's a matching directory, navigate into it
if matching_directories:
    matching_directory = os.path.join(parent_directory_path, matching_directories[0])
    print("Found directory:", matching_directory)
    
    # List files inside the matching directory
    files = [f for f in os.listdir(matching_directory) if os.path.isfile(os.path.join(matching_directory, f))]
    
    # Filter Excel files
    excel_files = [f for f in files if f.endswith('.xlsx') or f.endswith('.xls')]
    
    # Check if there is exactly one Excel file
    if len(excel_files) != 1:
        raise ValueError("There should be exactly one Excel file in the directory.")
    
    # Read all sheets from the Excel file
    file_path = os.path.join(matching_directory, excel_files[0])
    all_dfs = pd.read_excel(file_path, sheet_name=None)
    
    # Access each DataFrame individually
    df1 = all_dfs['Sheet1']  # Change 'Sheet1' to the actual sheet name
    df2 = all_dfs['Sheet2']  # Change 'Sheet2' to the actual sheet name
    df3 = all_dfs['Sheet3']  # Change 'Sheet3' to the actual sheet name
    
    # Example usage of the DataFrames
    print(df1.head())
    print(df2.head())
    print(df3.head())
    
else:
    print("No directory found for the current month and year.")
