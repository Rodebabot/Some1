import tkinter as tk
from tkinter import filedialog
import pandas as pd
from plyer import notification

class ExcelNotifierApp:
    def __init__(self, root):
        self.root = root
        self.root.title("Excel Notifier App")

        self.file_path = None

        self.create_widgets()

    def create_widgets(self):
        tk.Label(self.root, text="Select Excel File:").pack(pady=10)

        tk.Button(self.root, text="Browse", command=self.browse_file).pack(pady=5)

        self.submit_button = tk.Button(self.root, text="Submit", command=self.process_excel)
        self.submit_button.pack(pady=10)
        self.submit_button["state"] = "disabled"

        self.action_button = tk.Button(self.root, text="Action", command=self.perform_action)
        self.action_button.pack(pady=10)
        self.action_button["state"] = "disabled"

    def browse_file(self):
        self.file_path = filedialog.askopenfilename(filetypes=[("Excel files", "*.xlsx;*.xls")])
        if self.file_path:
            self.submit_button["state"] = "normal"

    def process_excel(self):
        df = pd.read_excel(self.file_path)
        pending_column = df['pending']
        time_column = df['time']

        for i in range(len(df)):
            if pending_column[i] > 1000 or time_column[i] > 3:
                notification.notify(
                    title="Notification",
                    message=f"Row {i+2}: Pending exceeds 1000 or Time exceeds 3",
                )
                self.action_button["state"] = "normal"

    def perform_action(self):
        df = pd.read_excel(self.file_path)
        total_pending = df['pending'].sum()
        total_time = df['time'].max()

        if total_pending > 2000:
            if total_time > 3:
                # Run amt.ipynb
                notification.notify(title="Action", message="Running amt.ipynb")
            else:
                # Run jub.ipynb
                notification.notify(title="Action", message="Running jub.ipynb")
        else:
            notification.notify(title="Action", message="No action required")

if __name__ == "__main__":
    root = tk.Tk()
    app = ExcelNotifierApp(root)
    root.mainloop()
