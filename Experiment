import os
from datetime import datetime, timedelta

# Function to get the second most recent directory
def get_second_recent_dir(dir_path):
    dirs = [d for d in os.listdir(dir_path) if os.path.isdir(os.path.join(dir_path, d))]
    dirs.sort(key=lambda x: datetime.strptime(x, '%d %b'), reverse=True)
    if len(dirs) >= 2:
        return dirs[1]
    else:
        return None

# Function to get the filename with the specified date
def get_file_with_date(dir_path, date):
    for file_name in os.listdir(dir_path):
        if date.strftime('%d%m') in file_name:
            return file_name
    return None

# Main function
def copy_file_for_second_recent_month():
    current_date = datetime.now()
    current_month_folder = current_date.strftime('%b %Y')
    current_month_path = os.path.join('path_to_your_folder', current_month_folder)
    
    if os.path.exists(current_month_path):
        second_recent_dir = get_second_recent_dir(current_month_path)
        
        if second_recent_dir:
            second_recent_dir_path = os.path.join(current_month_path, second_recent_dir)
            file_to_copy = get_file_with_date(second_recent_dir_path, current_date)
            
            if file_to_copy:
                # Copy the file to desired location
                file_path_to_copy = os.path.join(second_recent_dir_path, file_to_copy)
                destination_folder = 'path_to_destination_folder'
                destination_path = os.path.join(destination_folder, file_to_copy)
                os.makedirs(destination_folder, exist_ok=True)
                shutil.copy(file_path_to_copy, destination_path)
                print("File copied successfully!")
            else:
                print("File with specified date not found in second recent directory.")
        else:
            print("Second recent directory not found.")
    else:
        print("Current month folder not found.")

# Call the main function
copy_file_for_second_recent_month()
