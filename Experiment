import tkinter as tk
from tkinter import ttk
import pandas as pd
import webbrowser
import re

# Load the Excel file into a DataFrame
df = pd.read_excel("your_excel_file.xlsx")

def preprocess_input(input_sentence):
    # Split the input sentence into individual words
    words = input_sentence.lower().split()
    
    # Create a list to store the processed words
    processed_words = []
    
    for word in words:
        # Remove leading and trailing hyphens and spaces
        word = re.sub(r'^[ -]*(.*?)[ -]*$', r'\1', word)
        processed_words.append(word)
    
    # Join the processed words back into a sentence
    return ' '.join(processed_words)

def find_keywords(input_sentence):
    preprocessed_sentence = preprocess_input(input_sentence)
    
    # Create a list to store found keywords
    found_keywords = []
    
    # Find keywords based on their appearance in the input sentence
    for index, row in df.iterrows():
        keyword_in_row = row['Keyword'].lower()
        display_word = row['DisplayWord']
        
        if keyword_in_row in preprocessed_sentence:
            found_keywords.append(keyword_in_row)
    
    return found_keywords

def search_keywords():
    user_input = entry.get()
    found_keywords = find_keywords(user_input)
    
    keyword_displaywords = []  # List to store displaywords for the keywords
    close_matches = []  # List to store keyword - displayword pairs for other keywords
    
    for keyword in found_keywords:
        for index, row in df.iterrows():
            keyword_in_row = row['Keyword'].lower()
            display_word = row['DisplayWord']
            
            if keyword_in_row == keyword.lower():
                formatted_item = f"{keyword_in_row} - {display_word}"
                keyword_displaywords.append(formatted_item)
            elif keyword_in_row in keyword.lower():
                formatted_item = f"{keyword_in_row} - {display_word}"
                close_matches.append(formatted_item)
    
    displaywords_box.delete(0, tk.END)
    close_matches_box.delete(0, tk.END)
    
    for display_word in keyword_displaywords:
        displaywords_box.insert(tk.END, display_word)
    
    for item in close_matches:
        close_matches_box.insert(tk.END, item)

def open_url(event):
    selected_item = displaywords_box.get(displaywords_box.curselection())
    if selected_item:
        keyword_displayword = selected_item.split(" - ")
        keyword = keyword_displayword[0]
        display_word = keyword_displayword[1]
        for index, row in df.iterrows():
            if row['Keyword'].lower() == keyword.lower() and row['DisplayWord'] == display_word:
                webbrowser.open(row['URL'])
    
    selected_item = close_matches_box.get(close_matches_box.curselection())
    if selected_item:
        keyword_displayword = selected_item.split(" - ")
        keyword = keyword_displayword[0]
        display_word = keyword_displayword[1]
        for index, row in df.iterrows():
            if row['Keyword'].lower() == keyword.lower() and row['DisplayWord'] == display_word:
                webbrowser.open(row['URL'])

def copy_keyword():
    selected_item = close_matches_box.get(close_matches_box.curselection())
    if selected_item:
        keyword = selected_item.split(" - ")[0]  # Extract the keyword
        entry.delete(0, tk.END)
        entry.insert(0, keyword)
        # Copy the keyword to the clipboard
        root.clipboard_clear()
        root.clipboard_append(keyword)
        root.update()

# Create the main Tkinter window
root = tk.Tk()
root.title("Keyword Search App")

# Create and configure the search entry field
entry = ttk.Entry(root, width=30)
entry.grid(row=0, column=0, padx=10, pady=10)

# Create and configure the search button
search_button = ttk.Button(root, text="Search", command=search_keywords)
search_button.grid(row=0, column=1, padx=10, pady=10)

# Create and configure the displaywords listbox
displaywords_box = tk.Listbox(root, width=50, height=5)
displaywords_box.grid(row=1, column=0, columnspan=2, padx=10, pady=10)
displaywords_box.bind('<Double-Button-1>', open_url)

# Create and configure the close matches listbox
close_matches_box = tk.Listbox(root, width=50, height=5)
close_matches_box.grid(row=2, column=0, columnspan=2, padx=10, pady=10)
close_matches_box.bind('<Double-Button-1>', open_url)

# Create a button to copy the keyword from the second box
copy_button = ttk.Button(root, text="Copy Keyword", command=copy_keyword)
copy_button.grid(row=3, column=0, columnspan=2, padx=10, pady=10)

root.mainloop()
