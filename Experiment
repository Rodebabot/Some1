import tkinter as tk
from tkinter import ttk
from tkinter import messagebox
import openpyxl

# Function to handle the 'Submit' button
def submit():
    user_name = name_var.get()
    team = team_var.get()
    task = task_var.get()

    if team in data and task in data[team]:
        option = data[team][task]["option"]

        if option == "Fixed":
            result.set(data[team][task]["value"])
            entry.configure(state="disabled")  # Disable the input field
        else:
            try:
                value = float(entry.get())
                result.set(value * data[team][task]["value"])
                entry.configure(state="normal")  # Enable the input field
            except ValueError:
                messagebox.showerror("Error", "Please enter a valid number.")
                entry.configure(state="normal")  # Enable the input field
    else:
        messagebox.showerror("Error", "Team and task not found in data.")

# Initialize the main application window
app = tk.Tk()
app.title("Excel Data App")

# Initialize variables
name_var = tk.StringVar()
team_var = tk.StringVar()
task_var = tk.StringVar()
result = tk.StringVar()
result.set("Result will appear here")

# Create a text entry field for the user's name
name_label = ttk.Label(app, text="Enter Your Name:")
name_label.pack()
name_entry = ttk.Entry(app, textvariable=name_var)
name_entry.pack()

# Create dropdowns for team and task selection
team_label = ttk.Label(app, text="Select Team:")
team_label.pack()
teams = list(data.keys())
team_dropdown = ttk.Combobox(app, textvariable=team_var, values=teams)
team_dropdown.pack()

task_label = ttk.Label(app, text="Select Task:")
task_label.pack()
task_dropdown = ttk.Combobox(app, textvariable=task_var, values=[])
task_dropdown.pack()

# Entry for entering variable value
entry_label = ttk.Label(app, text="Enter Value:")
entry_label.pack()
entry = ttk.Entry(app, state="disabled")
entry.pack()

# Create a 'Submit' button
submit_button = ttk.Button(app, text="Submit", command=submit)
submit_button.pack()

# Display the result
result_label = ttk.Label(app, textvariable=result)
result_label.pack()

# Function to update task dropdown based on the selected team
def update_task_dropdown(event):
    selected_team = team_var.get()
    task_var.set("")  # Clear the task selection
    task_dropdown["values"] = list(data.get(selected_team, {}).keys())
    entry.configure(state="disabled")  # Disable the input field

team_dropdown.bind("<<ComboboxSelected>>", update_task_dropdown)

# Load data from Excel file (adjust the filename and sheet name)
workbook = openpyxl.load_workbook('your_excel_file.xlsx')
sheet = workbook['your_sheet_name']

data = {}

# Iterate through the Excel sheet and populate the data dictionary
for row in sheet.iter_rows(min_row=2, values_only=True):
    team_name = row[0]
    task_name = row[1]
    option = row[2]
    value = row[3]

    if team_name not in data:
        data[team_name] = {}

    data[team_name][task_name] = {"option": option, "value": value}

# Start the application
app.mainloop()
