import pandas as pd

# Load the dataset
file_path = '/mnt/data/your_excel_file.xlsx'  # Replace with the actual file path
df = pd.read_excel(file_path)

# Ensure the column names are correct as per the provided screenshot
df.columns = ['Unique Eventid', 'Legal Entity', 'Trade ID', 'ROC', 'Age', 'Age Band', 'Counterparty Name', 'Business Event', 'Product Representation', 'Days Spent', 'Action Items']

# Count ROC iterations per Unique Eventid
roc_iterations = df.groupby(['Unique Eventid', 'ROC']).size().reset_index(name='Iteration Count')

# Pivot the table to see counts per ROC for each Unique Eventid
pivot_table = roc_iterations.pivot(index='Unique Eventid', columns='ROC', values='Iteration Count').fillna(0)

print("ROC Iterations per Unique Eventid:")
print(pivot_table)

# Save pivot table to CSV for further analysis if needed
pivot_table.to_csv('/mnt/data/roc_iterations_per_eventid.csv')


# Calculate overall average iterations for each ROC
average_iterations = roc_iterations.groupby('ROC')['Iteration Count'].mean().reset_index(name='Average Iterations')

print("Overall Average Iterations per ROC:")
print(average_iterations)

# Save average iterations to CSV for further analysis if needed
average_iterations.to_csv('/mnt/data/average_iterations_per_roc.csv')
