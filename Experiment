import pandas as pd
import os
from datetime import datetime

# Specify the directory containing the Excel files
directory = 'path/to/your/files'

# Get today's date in the format "dd MMM"
today_date = datetime.now().strftime('%d %b')

# Initialize an empty list to hold the DataFrames
dataframes = []

# Loop through the files in the directory
for filename in os.listdir(directory):
    if today_date in filename and filename.endswith('.xlsx'):
        # Read the Excel file into a DataFrame
        file_path = os.path.join(directory, filename)
        df = pd.read_excel(file_path)
        dataframes.append((filename, df))

# Get the current month name
current_month = datetime.now().strftime('%B')

# Create the output file name with today's date in "dd MMM" format
output_filename = f'{today_date.replace(" ", "")}_{current_month}_Inter_Entity.xlsx'
output_path = os.path.join(directory, output_filename)

# Create a new Excel writer object
with pd.ExcelWriter(output_path, engine='openpyxl') as writer:
    for i, (filename, df) in enumerate(dataframes):
        # Write each DataFrame to a different sheet
        df.to_excel(writer, sheet_name=f'Sheet{i+1}', index=False)

print(f'New Excel file created at {output_path}')
