import os
import win32com.client

def fetch_outlook_email():
    outlook_app = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")

    # Replace 'YourMailbox' and 'YourSubfolder' with your actual mailbox and subfolder names
    mailbox = outlook_app.Folders.Item("YourMailbox")
    subfolder = mailbox.Folders.Item("YourSubfolder")

    # Limit the iterations to 15
    max_iterations = 15
    iteration_count = 0

    # Iterate through emails with the specified subject
    for item in subfolder.Items.Restrict("[Subject] LIKE '%pom pomb%'"):
        # Assuming you want to save the body as a .txt file
        save_path = f"{item.Subject}.txt"

        # Get the plain text body content
        plain_text_body = item.Body

        # Save the plain text body content to a .txt file
        with open(save_path, 'w', encoding='utf-8') as file:
            file.write(plain_text_body)

        iteration_count += 1
        if iteration_count >= max_iterations:
            break

if __name__ == "__main__":
    fetch_outlook_email()
