import win32com.client
import os
import datetime

# Connect to Outlook
outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")

# Specify the mailbox, inbox, and subfolder names
mailbox_name = "Mailbox Name"
inbox_folder_name = "Inbox"
subfolder_name = "Subfolder"

# Get the mailbox
mailbox = outlook.Folders.Item(mailbox_name)

# Navigate to the Inbox folder
inbox = mailbox.Folders.Item(inbox_folder_name)

# Navigate to the subfolder
subfolder = inbox.Folders.Item(subfolder_name)

# Get today's date
today_date = datetime.datetime.now().date()

# Find the oldest email received today
oldest_email = None
oldest_received_time = datetime.datetime.now()  # Initialize with current time
for item in subfolder.Items:
    if item.Class == 43:  # Mail item
        received_time = item.ReceivedTime
        if received_time.date() == today_date and received_time < oldest_received_time:
            oldest_email = item
            oldest_received_time = received_time

# Save the attachment from the oldest email of the day
if oldest_email:
    save_folder_path = r"C:\path\to\save\attachments"
    os.makedirs(save_folder_path, exist_ok=True)
    
    attachments = oldest_email.Attachments
    if attachments.Count > 0:
        # Assuming you want to save the first attachment
        attachment = attachments.Item(1)
        attachment_name = datetime.datetime.now().strftime("%Y-%m-%d") + os.path.splitext(attachment.FileName)[1]
        attachment.SaveAsFile(os.path.join(save_folder_path, attachment_name))
        print("Attachment saved successfully as:", attachment_name)
    else:
        print("No attachments found in the oldest email of the day.")
else:
    print("No email received today in the specified folder.")
