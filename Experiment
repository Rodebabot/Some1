import fitz  # PyMuPDF
from PIL import Image
import io

def count_images_after_sentence_exclude_image(pdf_path, target_sentence, exclude_image_path):
    # Open the PDF file
    pdf_document = fitz.open(pdf_path)

    # Read the content of the image to exclude
    exclude_image = Image.open(exclude_image_path)
    exclude_image_content = exclude_image.tobytes()

    # Initialize variables
    sentence_found = False
    image_count = 0

    # Iterate through each page
    for page_number in range(pdf_document.page_count):
        page = pdf_document[page_number]

        # Extract text from the page
        page_text = page.get_text()

        # Check if the target sentence is present on the page
        if target_sentence in page_text:
            sentence_found = True
            continue  # Skip counting images on pages before the sentence

        # Count images if the target sentence has been found
        if sentence_found:
            # Get the list of images on the page
            images_on_page = page.get_images()

            # Check if the content of the exclude_image matches any image on the page
            for img_ref in images_on_page:
                img = pdf_document.extract_image(img_ref)
                img_bytes = img["image"]

                if img_bytes != exclude_image_content:
                    image_count += 1

    # Close the PDF document
    pdf_document.close()

    return image_count

# Example usage
pdf_path = 'your_pdf_file.pdf'
target_sentence = 'ha ha ha hmm'
exclude_image_path = 'your_exclude_image.jpeg'  # Replace with the path to your JPEG image file
result = count_images_after_sentence_exclude_image(pdf_path, target_sentence, exclude_image_path)
print(f"Number of images after the occurrence of '{target_sentence}' excluding the specified image: {result}")
