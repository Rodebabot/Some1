import os
import win32com.client
from datetime import datetime, timedelta

def fetch_attachment_from_outlook(mailbox_name, subfolder_name, save_location):
    outlook = win32com.client.Dispatch("Outlook.Application").GetNamespace("MAPI")
    mailbox = outlook.Folders.Item(mailbox_name)
    inbox = mailbox.Folders.Item("Inbox")
    subfolder = inbox.Folders.Item(subfolder_name)

    # Get all emails in the subfolder
    mails = subfolder.Items
    # Sort the emails by ReceivedTime in descending order
    mails.Sort("[ReceivedTime]", True)

    # Get the date of the latest day
    if len(mails) >= 2:
        latest_day = mails.Item(1).ReceivedTime.date()
        # Find the latest email from the day before the latest day
        latest_day_minus_one = latest_day - timedelta(days=1)
        latest_mail = None
        for mail in mails:
            if mail.ReceivedTime.date() == latest_day_minus_one:
                latest_mail = mail
                break

        if latest_mail:
            # Check if there are attachments
            if latest_mail.Attachments.Count > 0:
                # Save each attachment
                for attachment in latest_mail.Attachments:
                    attachment.SaveAsFile(os.path.join(save_location, attachment.FileName))
                    print(f"Attachment '{attachment.FileName}' saved successfully.")
            else:
                print("No attachments found in the latest email of the day before the latest day.")
        else:
            print("No emails found in the day before the latest day.")
    else:
        print("There are not enough emails in the specified subfolder.")

# Usage example
fetch_attachment_from_outlook("Fram", "yoiiii", "C:/Attachments")
