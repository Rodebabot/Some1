import PyPDF2
import pandas as pd
import os

def extract_event_data(pdf_path):
    # Open the PDF file
    with open(pdf_path, 'rb') as pdf_file:
        pdf_reader = PyPDF2.PdfFileReader(pdf_file)
        
        # Extract text from the first page
        first_page_text = pdf_reader.getPage(0).extract_text()
        
        # Find the index of the word "Event"
        event_index = first_page_text.find("Event")
        
        # Find the index of the end of the line after "Event"
        end_of_line_index = first_page_text.find('\n', event_index)
        
        # Extract the text from "Event" to the end of the line
        event_data = first_page_text[event_index + len("Event"):end_of_line_index].strip()
        
        return event_data

def split_event_data(event_data):
    # Split the event data based on the provided format
    parts = event_data.split()
    return parts

def save_to_excel(pdf_path, event_data_parts):
    # Check if the Excel file already exists
    excel_file = 'event_data.xlsx'
    if os.path.exists(excel_file):
        # Load existing Excel file
        df = pd.read_excel(excel_file)
        
        # Add new data to the next available row
        new_row = {'PDF Name': pdf_path, 'Part 1': event_data_parts[0], 'Part 2': event_data_parts[1], 'Part 3': event_data_parts[2]}
        df = pd.concat([df, pd.DataFrame([new_row])], ignore_index=True)
    else:
        # Create a new Excel file and add headers
        df = pd.DataFrame({'PDF Name': [pdf_path], 'Part 1': [event_data_parts[0]], 'Part 2': [event_data_parts[1]], 'Part 3': [event_data_parts[2]]})
    
    # Save the DataFrame to Excel
    df.to_excel(excel_file, index=False)

# Replace 'your_directory_path' with the actual path to your directory containing PDFs
pdf_directory = 'your_directory_path'

# Iterate over all PDF files in the directory
for pdf_file in os.listdir(pdf_directory):
    if pdf_file.endswith(".pdf"):
        pdf_path = os.path.join(pdf_directory, pdf_file)

        # Extract event data from the PDF
        event_data = extract_event_data(pdf_path)

        # Split event data into three parts
        event_data_parts = split_event_data(event_data)

        # Save the data to Excel
        save_to_excel(pdf_path, event_data_parts)
