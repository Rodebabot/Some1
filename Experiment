import pandas as pd

# Load the Excel file
file_path = '/mnt/data/your_excel_file.xlsx'  # Replace with the actual file path
df = pd.read_excel(file_path)

# Ensure the column names are correct as per the provided screenshot
df.columns = ['Unique Eventid', 'Legal Entity', 'Trade ID', 'ROC', 'Age', 'Age Band', 'Counterparty Name', 'Business Event', 'Product Representation', 'Days Spent']

# Group by ROC, Age Band, Legal Entity, Business Event, Product Representation and count unique Unique Eventid
combo_counts = df.groupby(['ROC', 'Age Band', 'Legal Entity', 'Business Event', 'Product Representation'])['Unique Eventid'].nunique().reset_index(name='Unique Eventid Count')

# Get the top 3 combinations for each ROC and Age Band based on the number of unique Unique Eventid
top_combos = combo_counts.groupby(['ROC', 'Age Band']).apply(lambda x: x.nlargest(3, 'Unique Eventid Count')).reset_index(drop=True)

# Save the summary to a new Excel file
top_combos.to_excel('/mnt/data/top_combinations_roc_age_band_unique_eventid.xlsx', index=False)

print("Analysis completed. Summary saved to top_combinations_roc_age_band_unique_eventid.xlsx")
