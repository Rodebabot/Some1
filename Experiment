import pandas as pd

# Load the dataset
file_path = '/mnt/data/your_excel_file.xlsx'  # Replace with the actual file path
df = pd.read_excel(file_path)

# Ensure the column names are correct as per the provided screenshot
df.columns = ['Unique Eventid', 'Legal Entity', 'Trade ID', 'ROC', 'Age', 'Age Band', 'Counterparty Name', 'Business Event', 'Product Representation', 'Days Spent', 'Action Items']

# Group by ROC and calculate the average days spent and the standard deviation
roc_stats = df.groupby('ROC')['Days Spent'].agg(['mean', 'std']).reset_index()

# Calculate the coefficient of variation (CV) as std/mean
roc_stats['Coefficient of Variation'] = roc_stats['std'] / roc_stats['mean']

# Determine the median CV and average days spent for tagging
median_cv = roc_stats['Coefficient of Variation'].median()
median_days_spent = roc_stats['mean'].median()

# Create a new column for volatility tagging
roc_stats['Volatility Tag'] = roc_stats['Coefficient of Variation'].apply(lambda x: 'High' if x > median_cv else 'Low')

# Create a new column for average days spent tagging
roc_stats['Average Days Spent Tag'] = roc_stats['mean'].apply(lambda x: 'High' if x > median_days_spent else 'Low')

# Rename columns for clarity
roc_stats.columns = ['ROC', 'Average Days Spent', 'Standard Deviation', 'Volatility (Coefficient of Variation)', 'Volatility Tag', 'Average Days Spent Tag']

# Display the results
print(roc_stats)

# Save the results to an Excel file
roc_stats.to_excel('/mnt/data/roc_analysis_with_tags.xlsx', index=False)

print("ROC analysis with volatility and average days spent tagging saved to roc_analysis_with_tags.xlsx")
