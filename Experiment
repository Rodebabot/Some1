import tkinter as tk
from tkinter import ttk
from tkinter import messagebox
import openpyxl
import calendar

# Function to handle the 'Submit' button
def submit(index):
    team = team_vars[index].get()
    task = task_vars[index].get()

    if team in data and task in data[team]:
        option = data[team][task]["option"]

        if option == "Fixed":
            result_vars[index].set(data[team][task]["value"])
            entry_widgets[index].configure(state="disabled")  # Disable the input field
        else:
            try:
                value = float(entry_widgets[index].get())
                result_vars[index].set(value * data[team][task]["value"])
                entry_widgets[index].configure(state="normal")  # Enable the input field
            except ValueError:
                messagebox.showerror("Error", "Please enter a valid number.")
                entry_widgets[index].configure(state="normal")  # Enable the input field
    else:
        messagebox.showerror("Error", "Team and task not found in data.")

# Function to add a new set of input fields
def add_set():
    new_index = len(team_vars)
    
    # Create variables for the new set
    team_vars.append(tk.StringVar())
    task_vars.append(tk.StringVar())
    result_vars.append(tk.StringVar())
    result_vars[-1].set("Result will appear here")
    
    # Create team dropdown for the new set
    teams = list(data.keys())
    team_dropdown = ttk.Combobox(app, textvariable=team_vars[-1], values=teams)
    team_dropdown.grid(row=new_index, column=0)
    
    # Create task dropdown for the new set
    task_dropdown = ttk.Combobox(app, textvariable=task_vars[-1], values=[])
    task_dropdown.grid(row=new_index, column=1)
    
    # Create entry for entering variable value for the new set
    entry = ttk.Entry(app, state="disabled")
    entry.grid(row=new_index, column=2)
    entry_widgets.append(entry)
    
    # Create a 'Submit' button for the new set
    submit_button = ttk.Button(app, text="Submit", command=lambda index=new_index: submit(index))
    submit_button.grid(row=new_index, column=3)
    
    # Create a label for the result of the new set
    result_label = ttk.Label(app, textvariable=result_vars[-1])
    result_label.grid(row=new_index, column=4)

# Initialize the main application window
app = tk.Tk()
app.title("Excel Data App")

# Initialize lists for variables and entry widgets
team_vars = []
task_vars = []
result_vars = []
entry_widgets = []

# Create a 'Plus' button to add a new set
plus_button = ttk.Button(app, text="Add Set", command=add_set)
plus_button.grid(row=0, column=0, columnspan=5)

# Load data from Excel file (adjust the filename and sheet name)
workbook = openpyxl.load_workbook('your_excel_file.xlsx')
sheet = workbook['your_sheet_name']

data = {}

# Iterate through the Excel sheet and populate the data dictionary
for row in sheet.iter_rows(min_row=2, values_only=True):
    team_name = row[0]
    task_name = row[1]
    option = row[2]
    value = row[3]

    if team_name not in data:
        data[team_name] = {}

    data[team_name][task_name] = {"option": option, "value": value}

# Start the application
app.mainloop()
